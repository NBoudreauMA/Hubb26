<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hubbardston Budget Portal - Capital Improvement Plan</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: url('hubbardston_bg.jpg') no-repeat center center fixed;
            background-size: cover;
            color: white;
            min-height: 100vh;
        }
        
        nav {
            background: linear-gradient(90deg, rgba(34, 139, 34, 0.9), rgba(0, 100, 0, 0.9));
            padding: 15px;
            text-align: center;
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        nav a {
            color: white;
            margin: 0 20px;
            text-decoration: none;
            font-size: 22px;
            font-weight: bold;
            text-transform: uppercase;
            transition: 0.3s ease-in-out;
        }

        nav a:hover {
            text-decoration: underline;
            transform: scale(1.2);
            color: white;
            background-color: rgba(0, 100, 0, 0.7);
            border-radius: 5px;
        }
        
        nav a.active {
            color: white;
            text-decoration: underline;
            background-color: rgba(0, 100, 0, 0.7);
            padding: 8px 15px;
            border-radius: 5px;
        }
        
        .container {
            max-width: 1200px;
            margin: 120px auto 40px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.75);
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }
        
        h1, h2 {
            text-align: center;
            color: #4bc0c0;
            text-transform: uppercase;
            font-weight: 600;
            margin-top: 20px;
            margin-bottom: 25px;
            font-size: 32px;
            letter-spacing: 1px;
        }
        
        .intro-text {
            text-align: center; 
            font-size: 18px; 
            max-width: 900px; 
            margin: auto; 
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 40px;
            background: rgba(20, 20, 20, 0.7);
            color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
        }
        
        th, td {
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 14px 15px;
            text-align: left;
            font-size: 16px;
            word-wrap: break-word;
        }
        
        th {
            background: linear-gradient(135deg, #4bc0c0, #358a8a);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            padding: 15px;
            font-size: 15px;
        }
        
        .number-col {
            text-align: right;
            white-space: nowrap;
        }
        
        tr:nth-child(even) td {
            background: rgba(255, 255, 255, 0.05);
        }
        
        tr:hover td {
            background: rgba(75, 192, 192, 0.15);
            transition: background 0.3s ease;
        }
        
        .cip-section {
            background: linear-gradient(135deg, rgba(0, 60, 30, 0.85), rgba(0, 90, 70, 0.75));
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            border-left: 4px solid #4bc0c0;
            backdrop-filter: blur(5px);
        }
        
        .cip-section h3 {
            color: #4bc0c0;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: 600;
            text-align: center;
        }
        
        .cip-section p {
            margin-bottom: 15px;
            line-height: 1.7;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #4bc0c0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .error-message {
            color: #e74c3c;
            text-align: center;
            padding: 15px;
            background-color: rgba(231, 76, 60, 0.2);
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        .button-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }
        
        .cip-button {
            display: inline-block;
            padding: 12px 20px;
            background: rgba(0, 130, 100, 0.7);
            color: white;
            text-decoration: none;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .cip-button:hover {
            background: rgba(0, 150, 120, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* Footer style */
        .footer {
            background: linear-gradient(90deg, rgba(34, 139, 34, 0.9), rgba(0, 100, 0, 0.9));
            text-align: center;
            padding: 20px;
            width: 100%;
            box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.2);
            margin-top: 40px;
        }
        
        .footer p {
            margin: 10px 0;
            font-size: 16px;
            color: white;
        }
        
        .footer a {
            color: #4bc0c0;
            text-decoration: none;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 100px 15px 30px;
            }
            
            th, td {
                padding: 10px;
                font-size: 14px;
            }
            
            nav a {
                font-size: 16px;
                margin: 0 10px;
                padding: 5px;
            }
            
            .button-container {
                flex-direction: column;
                align-items: center;
            }
            
            .cip-button {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <nav>
        <a href="index.html">HOME</a>
        <a href="revenue.html">REVENUE</a>
        <a href="expenditures.html">EXPENDITURES</a>
        <a href="capital_plan.html" class="active">CAPITAL PLAN</a>
        <a href="citizens_guide.html">CITIZEN'S GUIDE</a>
    </nav>
    
    <div class="container">
        <h1>Capital Improvement Plan (FY26-30)</h1>
        <p class="intro-text">This five-year plan outlines Hubbardston's strategic investments in infrastructure, equipment, and facilities to ensure high-quality services and fiscal responsibility.</p>
        
        <div class="cip-section">
            <h3>Capital Planning Overview</h3>
            <p>Hubbardston's Capital Improvement Plan is a comprehensive framework that identifies and prioritizes the town's capital projects over the next five fiscal years (FY26-30). This planning approach ensures that critical infrastructure needs are addressed in a fiscally responsible manner, avoiding deferred maintenance costs and unexpected emergency repairs.</p>
            <p>Projects are evaluated based on several criteria, including public safety impact, service improvements, cost-effectiveness, and alignment with the town's strategic goals. Each project is assigned a priority level to guide funding decisions within our available resources.</p>
        </div>
        
        <div class="button-container">
            <a href="#one-year-plan" class="cip-button">ðŸ“Š One-Year Plan Details</a>
            <a href="#strategic-plan" class="cip-button">ðŸ’° Five-Year Strategic Plan</a>
            <a href="cip_report.pdf" class="cip-button" target="_blank">ðŸ“„ Download Complete CIP Report</a>
        </div>
        
        <div id="errorMessage" class="error-message">
            An error occurred while loading the capital improvement data. Please try again later.
        </div>
        
        <h2 id="one-year-plan">One-Year Capital Improvement Plan</h2>
        <div class="loading" id="oneYearLoading">Loading one-year plan data...</div>
        <table id="oneYearCIPTable">
            <thead></thead>
            <tbody></tbody>
        </table>
        
        <div class="cip-section">
            <h3>Funding Strategy</h3>
            <p>The one-year capital plan focuses on the most critical infrastructure and equipment needs for FY26. These investments are carefully balanced with operational funding needs to ensure budgetary stability while addressing essential capital requirements.</p>
            <p>Funding sources include a combination of tax levy, enterprise funds, borrowing, and grants. Projects with high public safety impact or potential for significant cost avoidance have been prioritized in the current fiscal year.</p>
        </div>
        
        <h2 id="strategic-plan">Strategic Capital Improvement Plan</h2>
        <div class="loading" id="strategicLoading">Loading five-year strategic plan data...</div>
        <table id="strategicCIPTable">
            <thead></thead>
            <tbody></tbody>
        </table>
        
        <div class="cip-section">
            <h3>Long-Term Planning Benefits</h3>
            <p>This five-year capital improvement plan provides numerous benefits to Hubbardston:</p>
            <ul>
                <li>Creates a structured framework for evaluating competing capital needs</li>
                <li>Allows for strategic planning of debt service and financing</li>
                <li>Coordinates interdependent projects to maximize efficiency</li>
                <li>Provides transparency to residents about upcoming infrastructure investments</li>
                <li>Helps secure grants and alternative funding by demonstrating planning foresight</li>
            </ul>
            <p>The Capital Improvement Committee reviews and updates this plan annually in coordination with department heads and the Town Administrator to ensure it remains responsive to changing conditions and priorities.</p>
        </div>
    </div>
    
    <div class="footer">
        <p>For questions or additional information about the Capital Improvement Plan, please contact the Town Administrator's Office at (978) 928-1400 X200 or <a href="mailto:admin@hubbardstonma.gov">admin@hubbardston.gov</a></p>
        <p>&copy; 2025 Town of Hubbardston | Last Updated: February 27, 2025</p>
    </div>
    
    <script>
        // Sample data to use when CSV files can't be loaded
        const sampleOneYearData = [
            ["Department", "Project", "Priority", "FY26 Cost"],
            ["DPW", "Road Repaving Project", "High", "$450,000.00"],
            ["Fire", "New Pumper Truck", "High", "$625,000.00"],
            ["Parks & Rec", "Playground Equipment", "Medium", "$75,000.00"],
            ["Police", "Vehicle Replacement", "Medium", "$65,000.00"],
            ["Town Hall", "HVAC System Upgrade", "Low", "$125,000.00"]
        ];
        
        const sampleStrategicData = [
            ["Department", "Project", "Priority", "FY26", "FY27", "FY28", "FY29", "FY30", "Total"],
            ["DPW", "Road Infrastructure", "High", "$450,000.00", "$475,000.00", "$500,000.00", "$525,000.00", "$550,000.00", "$2,500,000.00"],
            ["Fire", "Equipment Upgrades", "High", "$625,000.00", "$50,000.00", "$350,000.00", "$50,000.00", "$450,000.00", "$1,525,000.00"],
            ["Parks & Rec", "Facilities Improvement", "Medium", "$75,000.00", "$80,000.00", "$85,000.00", "$90,000.00", "$95,000.00", "$425,000.00"],
            ["Police", "Technology & Vehicles", "Medium", "$65,000.00", "$175,000.00", "$70,000.00", "$180,000.00", "$75,000.00", "$565,000.00"],
            ["Town Hall", "Building Maintenance", "Low", "$125,000.00", "$50,000.00", "$200,000.00", "$50,000.00", "$150,000.00", "$575,000.00"]
        ];

        function formatCurrency(value) {
            if (!value || value === "-") return "-";
            
            // Remove any existing formatting and convert to number
            let num = typeof value === 'string' 
                ? parseFloat(value.replace(/[^0-9.-]+/g, ""))
                : parseFloat(value);
                
            if (isNaN(num)) return value;
            
            return new Intl.NumberFormat('en-US', { 
                style: 'currency', 
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(num);
        }

        function cleanCSVRow(row) {
            return row
                .filter(cell => cell !== '') // Remove empty cells
                .map(cell => {
                    // Clean quotes and extra whitespace
                    return String(cell).trim().replace(/^"|"$/g, "");
                });
        }
        
        function parseCSV(csvText) {
            // Handle different line endings
            csvText = csvText.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
            
            const lines = csvText.split('\n');
            const result = [];
            
            // Process each line
            for (const line of lines) {
                if (!line.trim()) continue; // Skip empty lines
                
                // Simple CSV parsing (doesn't handle quoted commas)
                const row = line.split(',');
                result.push(cleanCSVRow(row));
            }
            
            return result;
        }

        function populateTable(tableId, data, hasNumericColumns = true) {
            const table = document.getElementById(tableId);
            
            // Clear existing content
            const thead = table.querySelector("thead");
            const tbody = table.querySelector("tbody");
            thead.innerHTML = "";
            tbody.innerHTML = "";
            
            // Create header row
            const headerRow = document.createElement("tr");
            data[0].forEach(header => {
                const th = document.createElement("th");
                th.textContent = header;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            
            // Create data rows
            data.slice(1).forEach(row => {
                const tr = document.createElement("tr");
                row.forEach((cell, index) => {
                    const td = document.createElement("td");
                    
                    // Format numeric columns (usually starting from index 2 or 3)
                    if (hasNumericColumns && index > 2) {
                        td.textContent = formatCurrency(cell);
                        td.classList.add("number-col");
                    } else {
                        td.textContent = cell;
                    }
                    
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
        }

        function loadTableData(filePath, tableId, loadingId, backupData) {
            const loadingElement = document.getElementById(loadingId);
            
            // Attempt to fetch the CSV file
            fetch(filePath)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(csvText => {
                    // Hide loading message
                    loadingElement.style.display = 'none';
                    
                    // Parse and display CSV data
                    const rows = parseCSV(csvText);
                    populateTable(tableId, rows);
                })
                .catch(error => {
                    console.warn(`Error loading CSV (${filePath}):`, error);
                    
                    // Hide loading message
                    loadingElement.style.display = 'none';
                    
                    // Use backup data instead
                    populateTable(tableId, backupData);
                });
        }
        
        // Initialize tables when the DOM is fully loaded
        document.addEventListener("DOMContentLoaded", function() {
            // Try to load CSV files, fall back to sample data if needed
            loadTableData("one_year_CIP.csv", "oneYearCIPTable", "oneYearLoading", sampleOneYearData);
            loadTableData("strategic_CIP.csv", "strategicCIPTable", "strategicLoading", sampleStrategicData);
            
            // Hide error message initially
            document.getElementById("errorMessage").style.display = "none";
            
            // Smooth scrolling for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 100,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>
